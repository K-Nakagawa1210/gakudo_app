<div class="main-container text-center">

  <div class="back-button-area mb-4">
    <%= link_to "å‰ã®ãƒšãƒ¼ã‚¸ã«æˆ»ã‚‹", attendance_index_schools_path, class: "btn btn-outline-secondary btn-sm" %>
  </div>

  <div class="clock-display mb-4">
    ğŸ•’ <span id="current-time"></span>
  </div>

  <h2 class="school-title mb-4"><%= @school.school_name %> ã®å…ç«¥</h2>

  <%= form_with url: attend_create_school_students_path(@school), method: :post, local: true, id: "attendance-form" do %>
    <% grouped_students = @students.group_by { |s| s.grade.level } %>

    <% grouped_students.sort.each do |grade_level, students| %>
      <div class="card mb-3 student-group-card">
        <div class="card-header bg-light fw-bold grade-header"><%= grade_level %>å¹´ç”Ÿ</div>
        <div class="card-body student-list">
          
          <div class="row row-cols-3 g-2"> 
            <% students.each do |student| %>
              <div class="col">
                <div class="student-button" 
                     data-student-id="<%= student.id %>"
                     data-bs-toggle="tooltip" data-bs-placement="top" title="æœªé¸æŠ">
                  
                  <%= student.student_name %>
                  <%= check_box_tag "student_ids[]", student.id, false, class: "d-none" %>
                  
                </div>
              </div>
            <% end %>
          </div>
          
        </div>
      </div>
    <% end %>

    <div class="submit-buttons-area mt-5 mb-5">
      <%= button_tag "ç™»åœ’", type: "submit", name: "action_type", value: "attend", class: "btn btn-lg attend-btn me-3" %>
      <%= button_tag "å¸°å®…", type: "submit", name: "action_type", value: "leave", class: "btn btn-lg leave-btn" %>
    </div>
  <% end %>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  // æ™‚åˆ»è¡¨ç¤ºã®é–¢æ•°ã‚’ä¿®æ­£ (æ—¥ä»˜ã¨æ™‚åˆ»ã®é–“ã«ã‚¹ãƒšãƒ¼ã‚¹ã‚’æŒ¿å…¥)
  function updateTime() {
    const now = new Date();
    const datePart = now.toLocaleString('ja-JP', {
      year: 'numeric', month: '2-digit', day: '2-digit'
    });
    const timePart = now.toLocaleString('ja-JP', {
      hour: '2-digit', minute: '2-digit', second: '2-digit'
    });
    // innerHTMLã‚’ä½¿ç”¨ã—ã¦ã‚¹ãƒšãƒ¼ã‚¹ï¼ˆ&nbsp;ï¼‰ã‚’æŒ¿å…¥
    document.getElementById("current-time").innerHTML = `${datePart} &nbsp;&nbsp; ${timePart}`;
  }

  updateTime();
  setInterval(updateTime, 1000); 

  // å…ç«¥ãƒœã‚¿ãƒ³ã®é¸æŠãƒ­ã‚¸ãƒƒã‚¯
  document.querySelectorAll('.student-button').forEach(button => {
    button.addEventListener('click', () => {
      button.classList.toggle('selected');
      
      // éš ã—ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã®çŠ¶æ…‹ã‚’ãƒˆã‚°ãƒ«
      const checkbox = button.querySelector('input[type="checkbox"]');
      if (checkbox) {
        checkbox.checked = !checkbox.checked;
      }
    });
  });
});
</script>