<div class="main-container-fluid text-center">

  <div class="header-area mb-4">
    <div class="date-navigation-group">
      <div class="mb-2">
        <%= link_to "＜先月", attendances_path(month: (@month - 1.month).strftime("%Y-%m-01")), class: "btn btn-outline-secondary date-nav-btn me-2" %>
        <%= link_to "来月＞", attendances_path(month: (@month + 1.month).strftime("%Y-%m-01")), class: "btn btn-outline-secondary date-nav-btn ms-2" %>
      </div>
      <h1 class="attendance-month-title"><%= @month.strftime("%Y年%m月") %> の出欠一覧</h1>
    </div>

    <%= link_to "Excel出力", export_xlsx_attendances_path(month: @month.strftime("%Y-%m-01")), class: "btn export-btn" %>
  </div>

  <div class="table-responsive shadow-sm attendance-monthly-card">
    <table class="table table-bordered attendance-monthly-table align-middle">
      <thead>
        <tr>
          <th class="student-name-header">児童名</th>
          <% @dates_with_weekday.each do |day_str| %>
            <th><%= day_str %></th>
          <% end %>
        </tr>
      </thead>
      <tbody>
        <% @students.each do |student| %>
          <tr>
            <td class="student-name-cell">
              <%= student.student_name.gsub(' ', '<br>').html_safe %>
            </td>
            <% @dates.each do |day| %>
              <% record = @attendances[day]&.find { |a| a.student_id == student.id } %>
              
              <td class="status-cell 
                <%= record ? (record.status == 'present' ? 'status-present' : 'status-absent') : 'status-unrecorded' %>">
                
                <% if record %>
                  <div class="time-container">
                    <div class="arrival-time">
                      <%= record.arrival_time.present? ? record.arrival_time.strftime("%H:%M") : '-' %>
                    </div>
                    <div class="leave-time">
                      <%= record.leave_time.present? ? record.leave_time.strftime("%H:%M") : '-' %>
                    </div>
                  </div>
                  <%= link_to "編集", edit_attendance_path(record), data: { turbo_frame: "modal" }, class: "btn btn-sm btn-edit mt-1" %>
                <% else %>
                  －
                <% end %>
              </td>
            <% end %>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>

  <div class="bottom-button-container">
    <%= link_to "トップに戻る", root_path, class: "back-to-top-btn" %>
  </div>

  <turbo-frame id="modal"></turbo-frame>
</div>