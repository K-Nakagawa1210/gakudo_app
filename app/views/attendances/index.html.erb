<h1>出欠一覧（<%= @month.strftime("%Y年%m月") %>）</h1>

<div style="margin-bottom: 20px;">
  <%= link_to "＜先月", attendances_path(month: (@month - 1.month).strftime("%Y-%m-01")), class: "btn btn-outline-primary" %>
  <%= link_to "来月＞", attendances_path(month: (@month + 1.month).strftime("%Y-%m-01")), class: "btn btn-outline-primary" %>

  <%= link_to "CSV出力", export_csv_attendances_path(month: @month.strftime("%Y-%m-01")), class: "btn btn-success", style: "float: right;" %>
</div>

<table border="1" cellspacing="0" cellpadding="4">
  <thead>
    <tr>
      <th>児童名</th>
      <% @dates.each do |day| %>
        <th><%= day.strftime("%-m/%-d") %></th>
      <% end %>
    </tr>
  </thead>
  <tbody>
    <% @students.each do |student| %>
      <tr>
        <td><%= student.student_name %></td>
        <% @dates.each do |day| %>
          <% record = @attendances[day]&.find { |a| a.student_id == student.id } %>
          <td style="text-align: center; vertical-align: middle;">
            <% if record %>
              <%= record.status == "present" ? "〇" : "×" %><br>
              <% if record.arrival_time.present? %>
                <small>登園: <%= record.arrival_time.strftime("%H:%M") %></small><br>
              <% end %>
              <% if record.leave_time.present? %>
                <small>帰宅: <%= record.leave_time.strftime("%H:%M") %></small><br>
              <% end %>
              <%= link_to "編集", edit_attendance_path(record), class: "btn btn-sm btn-secondary mt-1" %>
            <% else %>
              －
            <% end %>
          </td>
        <% end %>
      </tr>
    <% end %>
  </tbody>
</table>
